<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Reveal.js Presentation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- Link to Reveal.js core styles -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/theme/white.css">

    <!-- Optional: Link to Reveal.js syntax highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/plugin/highlight/monokai.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        .navigate-right, .navigate-left {
            display: none;
        }
        .slide-number {
            display: block;
            bottom: auto !important;
            top: 8px !important;
            font-size: 26px !important;
            border-radius: 7px !important;
        }
        img {
            margin: 0 !important;
        }
        body {
            background-color: #FFF1DB !important;
        }

        .mainSlide {
            text-align: left;
        }

        section.slide_5 {
            display: flex !important;
            align-items: center !important;
        }

        section.about-me {
            display: flex !important;
            flex-direction: row !important;
            gap: 20px;
        }

        section.about-me {
            text-align: left !important;
        }

        section.about-me p {
            font-size: 20px;
        }

        img.me {
            border-radius: 10px;
            margin: 0 !important;
        }

        .where_work {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        i.walk_icon {
            font-size: 50px;
        }

        .me_facts {
            font-size: 20px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        img.oh_no_selectors {
            position: absolute;
            width: 32%;
            transform: rotate(-34deg);
            left: 0;
        }
        .js-code {
            width: 100% !important;
        }
        .jsCodeSlide {
            top: 0 !important;
            height: 100%;
            display: flex !important;
            align-items: center !important;
        }

        /* Стили для строк кода */
        pre {
            position: relative !important;
            min-height: max-content !important;
            max-height: max-content !important;
            margin: 0 !important;
        }
        pre code {
            display: block;
            padding: 0 0 0 40px !important;
            min-height: max-content !important;
            max-height: max-content !important;
        }
        .line-numbers {
            position: absolute;
            left: 0;
            top: 0;
            padding-right: 10px;
            border-right: 1px solid #ddd; /* Граница между номерами и кодом */
            text-align: right;
            color: #999; /* Цвет для номеров строк */
        }

        .line-numbers span {
            display: block;
        }
        .fsd {
            display: flex;
        }
    </style>
</head>

<body>
    <div class="reveal">
        <div class="slides">
            <!-- Slide 1 -->
            <section class="about-me">
                <img class="me" src="./assets/me.jpg" alt="" width="400px">
                <div>
                    <h5>Как перестать быть фреймворк разработчиком?</h5>
                    <h6>Frontend TechLead</h6>
                    <div class="where_work">
                        <img src="./assets/tbank_logo.png" width="100px" alt="">
                        <i class="bi bi-person-walking walk_icon"></i>
                        <img src="./assets/hh_logo.png" width="70px" alt="">
                    </div>
                    <div class="me_facts">
                        <span>1. +8 лет в разработке</span>
                        <span>2. Опыт в стартапах и корпорациях</span>
                        <span>3. Люблю чистую архитектуру и писать тесты</span>
                        <span>4. Занимаюсь обучением и менторством</span>
                        <span>5. Люблю походы и катаюсь на эндуро мотоциклах</span>
                    </div>
                </div>
            </section>

            <!-- Slide 2 -->
            <section class="mainSlide">
                <h3>Что будет в докладе?</h3>
                <ul>
                    <li class="fragment fragment-grow">Разберем типичный код на react и его архитектуру</li>
                    <li class="fragment fragment-grow">Обсудим проблемы</li>
                    <li class="fragment fragment-grow">Сделаем рефакторинг, порисуем схемы</li>
                    <li class="fragment fragment-grow">Напишем юнит тесты</li>
                    <li class="fragment fragment-grow">Плюсы, минусы и полезные практики</li>
                </ul>
            </section>

            <!-- Slide 2 -->
            <section class="mainSlide">
                <h3>Почему вообще родился доклад?</h3>
                <!--
                    Проект на котором я работаю это преимущественно redux архитектура в которой
                    множество экшенов и селекторов. И все чем мы занимаемся на самом деле
                    это постоянно что-то диспатчим и что-то берем из стора, чтобы просто отобразить

                    То есть каждый раз, когда нам надо добавить новую функциональность или что-то поменять
                    нам постоянно приходиться взаимодействовать с api библиотек

                    Что порождает множество проблем связанных с переносимостью проекта, его расширением тестированием и тд
                    И меня это натолкнуло на мысль а можем ли мы писать вообще более независимый код. И я об этом сегодня расскажу

                    Вторая более косвенная проблема связана с тем, что я занимаюсь менторингом и проведением собеседований
                    и все чаще стал замечать насколько разработчики привязываются к конкретным инструментами и не до конца понимают
                    их назначение
                -->
            </section>
            <section>
                <img src="./assets/pribil_redux.png" alt="" width="80%">
            </section>
            <section>
                <img src="./assets/remove_redux.png" alt="" width="80%">
            </section>
            <section class="mainSlide">
                <h3>Обновление инструментов стало нормой</h3>
            </section>
            <section>
                <img src="./assets/hard_choice_meme.jpg" width="50%" alt="">
            </section>
            <section>
                <h3>Selectors/Actions Hell</h3>
                <img src="./assets/selectors_hell.png" alt="" width="35%">
                <img class="oh_no_selectors" src="./assets/oh_no.png" alt="">
            </section>
            <section>
                <img src="./assets/actions_hell.png" alt="" width="60%">
                <!-- <img class="oh_no_selectors" src="./assets/oh_no.png" alt=""> -->
            </section>
            <section class="mainSlide">
                <h3>Появились проблемы</h3>
                <ul>
                    <li class="fragment fragment-grow">Сложно вносить изменения</li>
                    <li class="fragment fragment-grow">Сложно разрабатывать тесты</li>
                    <li class="fragment fragment-grow">Сложно обновлять инструменты</li>
                </ul>
            </section>
            <!-- Slide 2 -->
            <section>
                <h3>Возьмем за основу пример с маркетплейсом</h3>
            </section>
            <!-- Slide 2 -->
            <section class="slide_5">
                <img data-src="./assets/img1.png" width="250px" height="500px">
                <ul>
                    <li class="fragment fragment-grow">Добавить товар в корзину</li>
                    <li class="fragment fragment-grow">Удалить товар из корзины</li>
                    <li class="fragment fragment-grow">Сохранять в браузерное хранилище</li>
                    <li class="fragment fragment-grow">Синхронизировать корзину с API</li>
                    <li class="fragment fragment-grow">Расширять корзину функционалом</li>
                </ul>
            </section>
            <section>
                <h3>Типичная архитектура такого проекта</h3>
            </section>
            <section>
                <img data-src="./assets/old_arch.png">
            </section>
            <section class="mainSlide">
                <h3>Сложно рефакторить</h3>
            </section>
            <section class="mainSlide jsCodeSlide">
                <pre class="js-code">
                    <div class="line-numbers">
                        <span>1</span>
                        <span>2</span>
                        <span>3</span>
                        <span>4</span>
                        <span>5</span>
                        <span>6</span>
                        <span>7</span>
                        <span>8</span>
                        <span>9</span>
                        <span>10</span>
                        <span>11</span>
                        <span>12</span>
                        <span>13</span>
                        <span>14</span>
                        <span>15</span>
                        <span>16</span>
                        <span>17</span>
                        <span>18</span>
                        <span>19</span>
                        <span>20</span>
                    </div>
                    <code class="javascript">
export const addToCartAction = async (productId) => {
    // Получаем продукт по ID
    const product = productStore.getProductById(productId);
    // Получаем количество продукта в коризне
    const productInBasket = basketStore.getProductCount(productId);

    // Проверяем, что товар еще доступен на складе
    const noAvailableAmount = executeAction(checkProductAvailable, { productId, productInBasket });
    if (noAvailableAmount) return;

    // Добавляем в корзину
    dispatch(ADD_TO_CART, { ...product, quantity: 1 })

    // Обновляем localStorage
    localStorage.setItem('cart', basketStore.getState());

    // Синхронизация с API
    await syncCartWithAPI();
};
                </code></pre>
            </section>
            <!-- Slide 2 -->
            <section class="mainSlide">
                <h3>Сложно тестировать</h3>
                <ul>
                    <li class="fragment fragment-grow">Приходиться мокать инструменты</li>
                    <li class="fragment fragment-grow">Тесты разрабатывать сложно и долго</li>
                    <li class="fragment fragment-grow">Тесты нестабильны</li>
                    <li class="fragment fragment-grow">Слабая мотивация разрабатывать тесты</li>
                </ul>
            </section>
            <section class="mainSlide jsCodeSlide">
                <pre class="js-code">
                    <div class="line-numbers">
                        <span>1</span>
                        <span>2</span>
                        <span>3</span>
                        <span>4</span>
                        <span>5</span>
                        <span>6</span>
                        <span>7</span>
                        <span>8</span>
                        <span>9</span>
                        <span>10</span>
                        <span>11</span>
                        <span>12</span>
                        <span>13</span>
                        <span>14</span>
                        <span>15</span>
                        <span>16</span>
                        <span>17</span>
                        <span>18</span>
                        <span>19</span>
                        <span>20</span>
                    </div>
                    <code class="javascript">
it('Проверка добавления товара в корзину', async () => {
    const context = mockAppContext({
        stores: [productStoreMock, baskStoreMock],
        services: [localStorageMock, apiMock]
    })
    // Мокируем ответ от API
    context.api.mockResponseOnce(JSON.stringify({ success: true }));

    await runAction(addToCartAction(productId));

    // Проверка, что товар в корзине
    expect(basketStore.getState()).toHaveBeenCalledWith(jsonToCheck);
    
    // Проверка обновления localStorage
    expect(localStorageMock).toHaveBeenCalledWith('cart', expect.any(String)); // Проверяем, что cart обновляется

    // Проверка вызова API
    expect(apiMock).toHaveBeenCalledTimes(1);
});
                </code></pre>
            </section>
            <section class="mainSlide">
                <h3>Сложно расширять</h3>
                <ul>
                    <li class="fragment fragment-grow">Приходиться залезать в логику экшенов</li>
                    <li class="fragment fragment-grow">Есть риск что-нибудь поломать</li>
                    <li class="fragment fragment-grow">Переписывать тесты</li>
                </ul>
            </section>
            <section class="mainSlide">
                <h3>Все начинается с домена</h3>
                <!-- 
                    Вообще я фанат подхода ООП даже при проектирования фронтенда и люблю
                    в коде генерировать все представлять в виде объектов реального мира

                    Давайте попробуем это сделать. Какие вообще сущности можно выделить, хотя бы даже касательно этого функционала
                -->
            </section>
            <section>
                <img src="./assets/new_arch_1.png" alt="">
            </section>
            <section class="mainSlide jsCodeSlide">
                <pre class="js-code">
                    <div class="line-numbers">
                        <span>1</span>
                        <span>2</span>
                        <span>3</span>
                        <span>4</span>
                        <span>5</span>
                        <span>6</span>
                        <span>7</span>
                        <span>8</span>
                        <span>9</span>
                        <span>10</span>
                        <span>11</span>
                        <span>12</span>
                        <span>13</span>
                        <span>14</span>
                        <span>15</span>
                        <span>16</span>
                        <span>17</span>
                        <span>18</span>
                        <span>19</span>
                        <span>20</span>
                        <span>21</span>
                        <span>22</span>
                        <span>23</span>
                        <span>24</span>
                        <span>25</span>
                    </div>
                    <code class="typescript">
import { ProductId } from '@/shared/types/product';
import { IBasket, IBasketProduct } from '../types';

export class Basket {
    products: IBasketProduct[] = [];
    productsCount: Record&lt;ProductId, number&gt; = {};

    constructor(defaultBasketState: IBasket) {}

    addItem(product: IBasketProduct) {}

    removeItem(product: IBasketProduct) {}

    clearProducts() {}

    get totalPrice() {}

    get obj(): IBasket {
        return {
            products: this.products,
            productsCount: this.productsCount,
        };
    }
}
                </code></pre>
            </section>
            <section>
                <img src="./assets/new_arch_3.png" alt="" width="80%">
            </section>
            <section>
                <h3>Избавляемся от зацепления с помощью DI</h3>
            </section>
            <section class="mainSlide jsCodeSlide">
                <pre class="js-code">
                    <div class="line-numbers">
                        <span>1</span>
                        <span>2</span>
                        <span>3</span>
                        <span>4</span>
                        <span>5</span>
                        <span>6</span>
                        <span>7</span>
                        <span>8</span>
                        <span>9</span>
                        <span>10</span>
                        <span>11</span>
                        <span>12</span>
                        <span>13</span>
                        <span>14</span>
                        <span>15</span>
                        <span>16</span>
                        <span>17</span>
                        <span>18</span>
                        <span>19</span>
                        <span>20</span>
                        <span>21</span>
                        <span>22</span>
                        <span>23</span>
                        <span>24</span>
                        <span>25</span>
                    </div>
                    <code class="typescript">
import { Basket } from './Basket';
import { IBasket, IBasketProduct } from '../types';
import { BrowserStorageType } from '@/shared/BrowserStorage';
import { ProductId } from '@/shared/types/product';

export class BasketManager {
    constructor(
        updateStore: (basket: IBasket) => void,
        updateApi: (basket: IBasket) => Promise&lt;void&gt;,
        browserStorageService: BrowserStorageType,
        defaultBasketState: IBasket
    ) {
        this.updateStore = updateStore;
        this.updateApi = updateApi;
        this.browserStorageService = browserStorageService;
        this.basket = new Basket(defaultBasketState);
    }

    handleAddItemToBasket(product: IBasketProduct) {
        this.basket.addItem(product);
        this.updateStore(this.basket.obj)
        this.updateApi(this.basket.obj)
        this.browserStorageService.set('basket', this.basket.obj)
    }
}
                </code></pre>
            </section>
            <section>
                <img src="./assets/new_arch_5.png" alt="" width="100%">
            </section>
            <section class="mainSlide jsCodeSlide">
                <pre class="js-code">
                    <div class="line-numbers">
                        <span>1</span>
                        <span>2</span>
                        <span>3</span>
                        <span>4</span>
                        <span>5</span>
                        <span>6</span>
                        <span>7</span>
                        <span>8</span>
                        <span>9</span>
                        <span>10</span>
                        <span>11</span>
                        <span>12</span>
                        <span>13</span>
                        <span>14</span>
                        <span>15</span>
                        <span>16</span>
                        <span>17</span>
                        <span>18</span>
                        <span>19</span>
                        <span>20</span>
                        <span>21</span>
                        <span>22</span>
                    </div>
                    <code class="typescript">
import { BasketManager } from '../models/BasketManager';
import { basketStore } from '../store/basketStore';
import { basketApiService } from '@/shared/api/basketApiService';
import { browserStorageService } from '@/shared/services/browserStorageService';

export const useGetBasketManager = () => {
    const basketState = basketStore().getBasketState();
    const updateBasketState = basketStore().updateBasketState;

    const basketManager = new BasketManager(
        updateBasketState,
        basketApiService,
        browserStorageService,
        basketState
    );

    return {
        basketManager,
    };
};
                </code></pre>
            </section>
            <!-- <section>
                <img src="./assets/new_arch_6.png" alt="" width="100%">
            </section> -->
            <section class="mainSlide">
                <h3>Легче тестировать функционал</h3>
            </section>
            <section class="mainSlide jsCodeSlide">
                <pre class="js-code">
                    <div class="line-numbers">
                        <span>1</span>
                        <span>2</span>
                        <span>3</span>
                        <span>4</span>
                        <span>5</span>
                        <span>6</span>
                        <span>7</span>
                        <span>8</span>
                        <span>9</span>
                        <span>10</span>
                        <span>11</span>
                        <span>12</span>
                        <span>13</span>
                        <span>14</span>
                        <span>15</span>
                        <span>16</span>
                    </div>
                    <code class="typescript">
it('Товар успешно добавляется в корзину', () => {
    basket = new Basket({ products: [], productsCount: {} });
    basket.addItem(mockedProduct);

    expect(basket.products).toHaveLength(1);
    expect(basket.productsCount).toStrictEqual({ '1': 1 });
    expect(basket.totalPrice).toBe(438.95);
    expect(basket.obj).toStrictEqual({
        products: [product],
        productsCount: {
            '1': 1,
        },
    });
});
                </code></pre>
            </section>
            <section class="mainSlide jsCodeSlide">
                <pre class="js-code">
                    <div class="line-numbers">
                        <span>1</span>
                        <span>2</span>
                        <span>3</span>
                        <span>4</span>
                        <span>5</span>
                        <span>6</span>
                        <span>7</span>
                        <span>8</span>
                        <span>9</span>
                        <span>10</span>
                        <span>11</span>
                        <span>12</span>
                        <span>13</span>
                        <span>14</span>
                        <span>15</span>
                        <span>16</span>
                        <span>17</span>
                        <span>18</span>
                        <span>19</span>
                        <span>20</span>
                    </div>
                    <code class="typescript">
test('Данные синхронизируются при добавлении в корзину', () => {
    const basketManager = new BasketManager(
        updateStoreMock, updateApiMock, browserStorageMock, defaultBasketState
    );
    basketManager.handleAddItemToBasket(mockedProduct);

    const dataForProduct = {
        products: [product],
        productsCount: {
            '1': 1,
        },
    };

    expect(basketManager.basket.obj).toStrictEqual(dataForProduct);
    expect(browserStorageMock.getItem('basket')).toStrictEqual(dataForProduct);
    expect(updateStoreMock).toHaveBeenCalled();
    expect(updateApiMock).toHaveBeenCalled();
});
                </code></pre>
            </section>
            <section class="mainSlide">
                <h3>Легко расширять</h3>
            </section>
            <section class="mainSlide jsCodeSlide">
                <pre class="js-code">
                    <div class="line-numbers">
                        <span>1</span>
                        <span>2</span>
                        <span>3</span>
                        <span>4</span>
                        <span>5</span>
                        <span>6</span>
                        <span>7</span>
                        <span>8</span>
                        <span>9</span>
                        <span>10</span>
                        <span>11</span>
                        <span>12</span>
                        <span>13</span>
                        <span>14</span>
                        <span>15</span>
                    </div>
                    <code class="typescript">
export class BasketManager {
    constructor(
        ...,
        notify: (message: string) => void
    ) {
        this.notify = notify;
    }

    handleAddItemToBasket(product: IBasketProduct) {
        ...
        this.notify('Товар добавлен в корзину')
    }
}
                </code></pre>
            </section>
            <section class="mainSlide">
                <h3>Логика не зависит от инструмента</h3>
            </section>
            <section>
                <img src="./assets/new_arch_5.png" alt="" width="100%">
            </section>
            <section class="mainSlide">
                <h3>Ниже порог входа и проще онбординг</h3>
            </section>
            <!-- <section class="mainSlide">
                <h3>Пример с генерацией данных для рендера (не сделано)</h3>
            </section> -->
            <section class="clean_arch_slide">
                <h3>Чистая архитектура</h3>
                <img src="./assets/clean_arch.png" alt="" width="80%">
            </section>
            <section class="clean_arch_slide">
                <img src="./assets/clean_arch_book.png" alt="" width="40%">
            </section>
            <section class="mainSlide">
                <h3>Feature Sliced Design</h3>
                <div class="fsd">
                    <img src="./assets/fsd.png" alt="" width="400px" height="250px">
                    <ul>
                        <li class="fragment fragment-grow">Разделение архитектурных слоев</li>
                        <li class="fragment fragment-grow">Понятные направления зависимостей</li>
                        <li class="fragment fragment-grow">Не является панацеей</li>
                    </ul>
                </div>
            </section>
            <section class="mainSlide">
                <h3>Что нужно учитывать?</h3>
                <ul>
                    <li class="fragment fragment-grow">Усложняется инфраструктура</li>
                    <li class="fragment fragment-grow">Учитывать цели и задачи бизнеса</li>
                </ul>
            </section>
            <section class="mainSlide">
                <blockquote>
                    > Сначала думай потом кодируй
                </blockquote>
            </section>
            <section class="mainSlide">
                <h3>Полезные ссылки</h3>
                <span>Тут будет qr код на ресурсы</span>
                <!-- <ul>
                    <li>https://bespoyasov.ru/blog/clean-architecture-on-frontend/</li>
                    <li>https://martinfowler.com/articles/modularizing-react-apps.html</li>
                    <li>https://www.ozon.ru/product/chistaya-arhitektura-iskusstvo-razrabotki-programmnogo-obespecheniya-martin-robert-144499396/?__rr=1
                    </li>
                    <li>https://refactoring.guru/ru</li>
                </ul> -->
            </section>
        </div>
    </div>

    <!-- Load Reveal.js -->
    <script src="https://cdn.jsdelivr.net/npm/reveal.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js/plugin/highlight/highlight.js"></script>

    <!-- Initialize Reveal.js -->
    <script>
        Reveal.initialize({
            // Optional Reveal.js settings
            controlsBackArrows: 'hidden',
            progress: true,
            center: true,
            hash: true,
            autoAnimate: false,
            slideNumber: 'c / h',
            plugins: [ RevealHighlight ]
        });
        // document.addEventListener('DOMContentLoaded', (event) => {
        //     hljs.highlightAll();
        // });
    </script>
</body>

</html>